---
import { Image } from "astro:assets";
import UserBox from "../components/UserBox.astro";

import send from "../assets/send.svg";
import chaosInc from "../assets/Chaos_Technologies_banner.png";
import simon from "../assets/simon.webp";
import Font from "astro/components/Font.astro";
import SimonBox from "../components/SimonBox.astro";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/webp" href={simon.src} />
    <!-- <link rel="icon" href="/favicon.ico" /> -->
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta
      name="description"
      content="chat application made by squawkykaka for a school project"
    />
    <script src="../scripts/main.ts"></script>
    <title>Astro</title>
    <Font cssVariable="--font-cute" preload />
  </head>
  <body>
    <SimonBox />
    <div id="content">
      <div class="titleSection">
        <h1 class="titleBar">Chat</h1>
        <h2 id="userName">Anonymous</h2>
      </div>

      <div class="loginSection">
        <details>
          <summary>Login/Signup</summary>
          <form id="signupForm">
            <button type="submit">Sign Up</button>
            <input type="email" name="email" placeholder="Email" />
            <input type="password" name="password" placeholder="Password" />
            <input type="text" name="displayName" placeholder="Display Name" />
          </form>
          <form id="loginForm">
            <button type="submit">Login</button>
            <input type="email" name="email" placeholder="Email" />
            <input type="password" name="password" placeholder="Password" />
            <p></p>
          </form>
        </details>

        <div>
          <UserBox />
        </div>
      </div>

      <div class="messageSection">
        <ul id="changeList"></ul>

        <div class="chat-banner">
          <Image
            src={chaosInc}
            alt="Chaos technologies banner"
            style="width: 100%; height: 100%;"
            layout="constrained"
            width={200}
            height={100}
            fetchpriority="high"
            loading="eager"
          />
        </div>

        <form id="headingForm">
          <input type="text" name="message" placeholder="Message" />

          <button id="headingButton" type="submit" disabled>
            <Image src={send} alt="send message" loading="eager" />
          </button>
        </form>
      </div>

      <!-- Project Details -->
      <details style="margin-top: 2ch;">
        <summary>The instructions for the project</summary>
        <p>
          Your tasks:
          <h2>JavaScript</h2>
          <ul>
            <li>
              Connect the JavaScript file - this page will tell you when it is
              done ✅
            </li>
            <li>
              Add a button - Make it change the heading "You pressed the
              button!" ✅
            </li>
            <li>Add a text input</li>
            <li>The button puts the text in the heading</li>
            <li>
              Get rid of the alert - the button updates the heading of this page
              ✅
            </li>
          </ul>
          <h4>Firebase basics</h4>

          <ul>
            <li>Create a new Firebase or re-use yours from last year ✅</li>
            <li>Remember how to connect up the 'authorised domains'</li>
            <li>Add a button - Make it save the text to Firebase ✅</li>
            <li>
              Add another button - Make it read the message from Firebase and
              write it to the heading of this page ✅
            </li>
          </ul>
          <h4>Firebase logins</h4>
          <ul>
            <li>Use Google Authentication</li>
            <li>
              Change what the first button does. Now it saves the text and the
              user who entered it ✅
            </li>
            <li>
              Change what the second button does. Now it displays all the
              messages and who added them ✅
            </li>
          </ul>
          <h4>Extension</h4>
          <ul>
            <li>
              Firebase now stores a list of messages saved by each user ✅
            </li>
            <li>There is a button that only displays your messages ✅</li>
            <li>
              You can filter to only display messages from a specific user ✅
            </li>
          </ul>
          <p>
            You learned all this last year. You just need to remember how!<br />
            You can Google it, ask a friend, copy from last year's work, even look
            at
            <a
              href="https://sites.google.com/hvhs.school.nz/technology/COMP/12COMP/12-databases/br-firebase-skills"
              >last year's notes</a
            >, works for you.<br />
            By the end of the week you will have Firebase going.
          </p>
        </p>
      </details>
    </div>
  </body>
</html>

<style>
  /* @font-face {
    font-family: cute;
    src: url("/TsunagiGothic.ttf");
  } */

  .titleBar {
    font-family: var(--font-cute);
    font-size: 60px;
    /* line-height: 0.5; */
    /* margin-top: -10px; */
    text-shadow:
      -1px -1px 0 #ffffff,
      1px -1px 0 #ffffff,
      -1px 1px 0 #ffffff,
      1px 1px 0 #ffffff;
  }

  .titleSection {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: -30px;
  }

  :root {
    --primary-background-color: #ffffe7;
    --primary-content-color: #eee7ca;
    --primary-border-color: #fffcbb;
    --primary-text-color: #9ca288;
    --message-color: #9ca288;
  }

  body {
    background-color: var(--primary-background-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    /* color: var(--primary-text-color); */
  }

  #content {
    margin-top: 2ch;
    width: 60ch;
    padding: 2ch;
  }

  .loginSection,
  .messageSection {
    background-color: var(--primary-content-color);
    outline: 5px dashed var(--primary-border-color);
  }

  .messageSection {
    position: relative;
  }

  #changeList {
    height: 60vh;
    overflow-y: scroll;
    list-style: none;
    padding-left: 0;

    display: flex;
    flex-direction: column;
  }

  .chat-banner {
    position: absolute;
    bottom: 0; /* align with input bottom */
    left: 0;
    transform: translateX(-110%);
    width: 200px;
    height: 100px;
    /* pointer-events: none; optional: clicks pass through */
  }

  .chat-banner img {
    object-fit: contain;
  }

  #headingForm {
    display: flex;
  }

  #headingForm input {
    width: 100%;
  }

  details {
    border: 1px solid #969696;
    padding: 0.5rem;
    border-radius: 6px;
  }

  summary {
    cursor: pointer;
    font-weight: 600;
  }

  details[open] summary {
    margin-bottom: 0.5rem;
  }
</style>

<style is:global>
  #changeList li {
    margin-top: 6px;
    width: 80%;

    background-color: var(--message-color);

    margin-left: 1ch;
    margin-right: 1ch;

    display: grid;
    grid-template-areas:
      "author time"
      "content content";
  }

  #changeList li.personalMessage {
    align-self: flex-end;
    border-radius: 10px 10px 0px 10px;
  }

  #changeList li:not(.personalMessage) {
    align-self: flex-start;
    border-radius: 10px 10px 10px 0px;
  }

  #changeList li > p:nth-child(1) {
    grid-area: content;
  }
  #changeList li > p:nth-child(2) {
    grid-area: time;
  }
  #changeList li > p:nth-child(3) {
    grid-area: author;
  }
</style>
